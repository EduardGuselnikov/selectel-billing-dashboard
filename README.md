# Selectel Billing ETL System

–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —Å–±–æ—Ä–∞ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö Selectel Billing –≤ PostgreSQL —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –≤ Redash –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∂–∏–≤—ã—Ö –¥–∞—à–±–æ—Ä–¥–æ–≤.

## üéØ –¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞

–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–±–æ—Ä –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö Selectel Billing –≤ –±–∞–∑–µ PostgreSQL –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å—Ç—Ä–æ–∏—Ç—å –∂–∏–≤—ã–µ –¥–∞—à–±–æ—Ä–¥—ã –≤ Redash.

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### API —Ç–æ–∫–µ–Ω Selectel
–î–ª—è —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º **—Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–æ–∫–µ–Ω (X-Token)** Selectel, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–æ—Å—Ç—É–ø –∫ API –±–∏–ª–ª–∏–Ω–≥–∞.

**–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω:**
1. –í–æ–π–¥–∏—Ç–µ –≤ [–ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Selectel](https://my.selectel.ru)
2. –í –≤–µ—Ä—Ö–Ω–µ–º –º–µ–Ω—é –Ω–∞–∂–º–∏—Ç–µ **–ê–∫–∫–∞—É–Ω—Ç**
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª **–î–æ—Å—Ç—É–ø** ‚Üí –≤–∫–ª–∞–¥–∫–∞ **API-–∫–ª—é—á–∏**
4. –ù–∞–∂–º–∏—Ç–µ **–î–æ–±–∞–≤–∏—Ç—å –∫–ª—é—á**
5. –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–ª—é—á–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "Redash ETL")
6. –ù–∞–∂–º–∏—Ç–µ **–î–æ–±–∞–≤–∏—Ç—å** –∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω

üìñ **–ü–æ–¥—Ä–æ–±–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏**: 
- [–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω Selectel](SELECTEL_TOKEN.md)
- [–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://docs.selectel.ru/api/authorization/#get-static-token)

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Docker –∏ Docker Compose
- 2 –ì–ë —Å–≤–æ–±–æ–¥–Ω–æ–π –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏
- 5 –ì–ë —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ

## üìã –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

- **ETL-—Å–∫—Ä–∏–ø—Ç** –Ω–∞ Python –¥–ª—è —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ API Selectel
- **PostgreSQL** —Å—Ö–µ–º–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —á–µ—Ç—ã—Ä–µ—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö:
  - –ë–∞–ª–∞–Ω—Å—ã (balances)
  - –ü—Ä–æ–≥–Ω–æ–∑—ã —Ä–∞—Å—Ö–æ–¥–æ–≤ (predictions)
  - –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (transactions)
  - –û—Ç—á–µ—Ç—ã –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º (project_reports)
- **Redash –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** —Å –≥–æ—Ç–æ–≤—ã–º–∏ SQL-–∑–∞–ø—Ä–æ—Å–∞–º–∏ –∏ –¥–∞—à–±–æ—Ä–¥–∞–º–∏
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ** API-—Ç–æ–∫–µ–Ω–∞ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è** —á–µ—Ä–µ–∑ cron –∏–ª–∏ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Selectel API  ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   ETL Script    ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   PostgreSQL    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                ‚îÇ                       ‚îÇ
                                ‚ñº                       ‚ñº
                       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                       ‚îÇ     Logs        ‚îÇ    ‚îÇ     Redash      ‚îÇ
                       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü–æ–ª–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# 1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/EduardGuselnikov/redash-std.git
cd redash-std

# 2. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
cp .env.example .env

# 3. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env - —É–∫–∞–∂–∏—Ç–µ –≤–∞—à Selectel API —Ç–æ–∫–µ–Ω
nano .env  # –ó–∞–º–µ–Ω–∏—Ç–µ your_selectel_static_token_here –Ω–∞ –≤–∞—à —Ç–æ–∫–µ–Ω

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–æ–ª–Ω—É—é —É—Å—Ç–∞–Ω–æ–≤–∫—É —Å –¥–∞—à–±–æ—Ä–¥–∞–º–∏
make docker-setup-complete

# 5. –ì–æ—Ç–æ–≤–æ! –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:5000
# üìä –î–∞—à–±–æ—Ä–¥—ã –Ω–∞—Å—Ç—Ä–æ—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –µ—Å–ª–∏ –≤ .env —É–∫–∞–∑–∞–Ω—ã REDASH_ADMIN_EMAIL –∏ REDASH_ADMIN_PASSWORD
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü–æ—à–∞–≥–æ–≤–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# 1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
git clone https://github.com/EduardGuselnikov/redash-std.git
cd redash-std
cp .env.example .env
nano .env  # –£–∫–∞–∂–∏—Ç–µ –≤–∞—à Selectel API —Ç–æ–∫–µ–Ω

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã
make docker-up

# 3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Redash
make setup-redash

# 4. –°–æ–∑–¥–∞–π—Ç–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
# –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:5000/setup –∏ —Å–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

# 5. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –¥–∞—à–±–æ—Ä–¥—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
make setup-dashboards
```

### ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .env —Ñ–∞–π–ª–∞

–ü–æ—Å–ª–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è `.env.example` –≤ `.env`, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∂–∏—Ç–µ:

```bash
# –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û: –í–∞—à —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–æ–∫–µ–Ω Selectel
SELECTEL_API_TOKEN=–≤–∞—à_—Ä–µ–∞–ª—å–Ω—ã–π_—Ç–æ–∫–µ–Ω_–∑–¥–µ—Å—å

# –†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø: –°–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
DB_PASSWORD=–≤–∞—à_–±–µ–∑–æ–ø–∞—Å–Ω—ã–π_–ø–∞—Ä–æ–ª—å
POSTGRES_PASSWORD=–≤–∞—à_postgres_–ø–∞—Ä–æ–ª—å
REDASH_DATABASE_PASSWORD=–≤–∞—à_redash_–ø–∞—Ä–æ–ª—å
REDASH_ADMIN_PASSWORD=–≤–∞—à_–∞–¥–º–∏–Ω_–ø–∞—Ä–æ–ª—å
REDASH_SECRET_KEY=–≤–∞—à_—Å–µ–∫—Ä–µ—Ç–Ω—ã–π_–∫–ª—é—á
REDASH_COOKIE_SECRET=–≤–∞—à_cookie_—Å–µ–∫—Ä–µ—Ç
```

üìñ **–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω Selectel**: [SELECTEL_TOKEN.md](SELECTEL_TOKEN.md)

## üê≥ Docker —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### 1. –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫

```bash
# –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–æ–≤
make docker-build

# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
make docker-up

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
make docker-logs
```

–ü–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞ Redash –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –≤ –±—Ä–∞—É–∑–µ—Ä–µ –Ω–∞ `http://localhost:5000`.

–ü–µ—Ä–≤–∏—á–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Redash:
- –ù–∞ –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∑–∞–¥–∞–π—Ç–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç
- –ó–∞—Ç–µ–º –≤ Settings ‚Üí Data Sources –¥–æ–±–∞–≤—å—Ç–µ PostgreSQL (`selectel_billing`)

### 2. –û—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
make docker-down
```

## ‚è∞ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Cron

```bash
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ cron
make cron-setup

# –ò–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –≤—Ä—É—á–Ω—É—é –≤ crontab:
# 0 * * * * /path/to/project/cron_etl.sh
```

## üìä Redash –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

> üìã **–ü–æ–¥—Ä–æ–±–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏**: –°–º. [REDASH_SETUP.md](REDASH_SETUP.md) –¥–ª—è –ø–æ—à–∞–≥–æ–≤–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### 1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL

–í Redash —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π Data Source:
- **Type**: PostgreSQL
- **Host**: localhost (–∏–ª–∏ IP –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞)
- **Port**: 5432
- **Database**: selectel_billing
- **Username**: selectel_user
- **Password**: –≤–∞—à_–ø–∞—Ä–æ–ª—å

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î Redash (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):
- Host: `postgres`
- Database: `redash`
- User: `redash`
- Password: `redash_password`

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤

## üé® –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–∞—à–±–æ—Ä–¥–æ–≤

–ü—Ä–æ–µ–∫—Ç –≤–∫–ª—é—á–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É –¥–∞—à–±–æ—Ä–¥–æ–≤ Redash —Å –≥–æ—Ç–æ–≤—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è–º–∏.

### üöÄ –ß—Ç–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

1. **–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö PostgreSQL** - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö `selectel_billing`
2. **4 –≥–æ—Ç–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–∞** - –≤—Å–µ –∫–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
3. **1 –æ—Å–Ω–æ–≤–Ω–æ–π –¥–∞—à–±–æ—Ä–¥** —Å –ø–æ–ª–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–π

### üìã –ì–æ—Ç–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã:

- **–¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å** - –æ–±—â–∏–π –±–∞–ª–∞–Ω—Å –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –¥–∞—Ç—É
- **–ü—Ä–æ–≥–Ω–æ–∑—ã —Ä–∞—Å—Ö–æ–¥–æ–≤** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –¥–æ –∏—Å—á–µ—Ä–ø–∞–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
- **–û—Ç—á–µ—Ç—ã –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º** - —Ä–∞—Å—Ö–æ–¥—ã –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º –∑–∞ —Ç–µ–∫—É—â–∏–π –≥–æ–¥
- **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø–æ —É—Å–ª—É–≥–∞–º** - —Ä–∞—Å—Ö–æ–¥—ã —Å –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–æ–π –ø–æ –º–µ—Å—è—Ü–∞–º –∏ —É—Å–ª—É–≥–∞–º

### ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

–í—Å–µ –¥–∞—à–±–æ—Ä–¥—ã –∏ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ —Ñ–∞–π–ª `redash_config.json`. –í—ã –º–æ–∂–µ—Ç–µ:
- –ò–∑–º–µ–Ω–∏—Ç—å SQL-–∑–∞–ø—Ä–æ—Å—ã
- –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- –°–æ–∑–¥–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞—à–±–æ—Ä–¥—ã
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ç–µ–≥–∏ –∏ –æ–ø–∏—Å–∞–Ω–∏—è

üìñ **–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è**: [DASHBOARD_SETUP.md](DASHBOARD_SETUP.md)

## üìä –ü—Ä–∏–º–µ—Ä—ã SQL-–∑–∞–ø—Ä–æ—Å–æ–≤

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–æ—Ç–æ–≤—ã–µ SQL-–∑–∞–ø—Ä–æ—Å—ã –∏–∑ —Ñ–∞–π–ª–∞ `redash_queries.sql`:

#### –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å
```sql
SELECT 
    balance_id,
    currency,
    amount,
    credit_limit,
    status,
    fetched_at
FROM balances 
WHERE fetched_at = (SELECT MAX(fetched_at) FROM balances)
ORDER BY balance_id;
```

#### –î–∏–Ω–∞–º–∏–∫–∞ –±–∞–ª–∞–Ω—Å–∞
```sql
SELECT 
    DATE(fetched_at) as date,
    balance_id,
    currency,
    AVG(amount) as avg_amount,
    MIN(amount) as min_amount,
    MAX(amount) as max_amount
FROM balances 
WHERE fetched_at >= CURRENT_DATE - INTERVAL '30 days'
GROUP BY DATE(fetched_at), balance_id, currency
ORDER BY date DESC, balance_id;
```

#### –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π
```sql
SELECT 
    DATE(created) as date,
    transaction_type,
    balance,
    COUNT(*) as transaction_count,
    SUM(ABS(price)) as total_amount
FROM transactions 
WHERE created >= CURRENT_DATE - INTERVAL '7 days'
GROUP BY DATE(created), transaction_type, balance
ORDER BY date DESC, total_amount DESC;
```

#### –†–∞—Å—Ö–æ–¥—ã –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º –∑–∞ —Ç–µ–∫—É—â–∏–π –≥–æ–¥
```sql
SELECT 
    year,
    month,
    project_name,
    balance_type,
    value
FROM project_reports 
WHERE year = EXTRACT(YEAR FROM CURRENT_DATE)
ORDER BY year DESC, month DESC, value DESC;
```

### 3. –°–æ–∑–¥–∞–Ω–∏–µ –¥–∞—à–±–æ—Ä–¥–∞

1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –¥–∞—à–±–æ—Ä–¥ –≤ Redash
2. –î–æ–±–∞–≤—å—Ç–µ –∑–∞–ø—Ä–æ—Å—ã –∫–∞–∫ –≤–∏–¥–∂–µ—Ç—ã
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 5-15 –º–∏–Ω—É—Ç)

## üìà –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏

### –ë–∞–ª–∞–Ω—Å—ã
- –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –ø–æ –∞–∫–∫–∞—É–Ω—Ç–∞–º
- –î–∏–Ω–∞–º–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
- –ö—Ä–µ–¥–∏—Ç–Ω—ã–µ –ª–∏–º–∏—Ç—ã –∏ —Å—Ç–∞—Ç—É—Å—ã

### –ü—Ä–æ–≥–Ω–æ–∑—ã
- –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –ø–æ —Ç–∏–ø–∞–º –±–∞–ª–∞–Ω—Å–æ–≤
- –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≥–Ω–æ–∑–æ–≤ –ø–æ —Å–µ—Ä–≤–∏—Å–∞–º

### –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å –Ω–∞—á–∞–ª–∞ –≥–æ–¥–∞ (–ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å—Ç–∞—Ä—Ç–µ —Å–∫—Ä–∏–ø—Ç–∞)
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫–∞–∂–¥—ã–π —á–∞—Å –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 2 —á–∞—Å–∞
- –†–∞—Å—Ö–æ–¥—ã –ø–æ —É—Å–ª—É–≥–∞–º –∏ —Å–µ—Ä–≤–∏—Å–∞–º
- –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–π
- –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∞–Ω–æ–º–∞–ª—å–Ω—ã—Ö —Ç—Ä–∞—Ç

### –û—Ç—á–µ—Ç—ã –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º
- –ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –Ω–∞—á–∞–ª–∞ –≥–æ–¥–∞ –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å—Ç–∞—Ä—Ç–µ —Å–∫—Ä–∏–ø—Ç–∞ (–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –Ω–∞–ª–∏—á–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î)
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –µ–∂–µ—á–∞—Å–Ω–æ —Ç–æ–ª—å–∫–æ –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü
- –ú–µ—Å—è—á–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º –∏ —Ç–∏–ø–∞–º –±–∞–ª–∞–Ω—Å–æ–≤
- –î–∏–Ω–∞–º–∏–∫–∞ —Ä–∞—Å—Ö–æ–¥–æ–≤ –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º –∑–∞ –≥–æ–¥
- –¢–æ–ø –ø—Ä–æ–µ–∫—Ç–æ–≤ –ø–æ —Ä–∞—Å—Ö–æ–¥–∞–º
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–æ–≤ –º–µ–∂–¥—É –º–µ—Å—è—Ü–∞–º–∏


## üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–æ–º

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
make help

# –ó–∞–ø—É—Å–∫ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∞
make docker-up              # –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
make docker-down            # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
make docker-logs            # –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞
make setup-redash           # –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Redash
make setup-dashboards       # –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–∞—à–±–æ—Ä–¥—ã (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ .env)
make setup-dashboards-only  # –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ç–æ–ª—å–∫–æ –¥–∞—à–±–æ—Ä–¥—ã (–±–µ–∑ —Å–æ–∑–¥–∞–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞)

# –ü–æ–ª–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞
make docker-setup-complete  # –ü–æ–ª–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å –¥–∞—à–±–æ—Ä–¥–∞–º–∏ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω .env)
make docker-fresh-install  # –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å –Ω—É–ª—è

# –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
make run-once               # –ó–∞–ø—É—Å—Ç–∏—Ç—å ETL –æ–¥–∏–Ω —Ä–∞–∑
make test                   # –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
```

### ‚è±Ô∏è –í—Ä–µ–º—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏

- **–ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫**: 5-8 –º–∏–Ω—É—Ç (–∑–∞–≥—Ä—É–∑–∫–∞ –æ–±—Ä–∞–∑–æ–≤ + —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö)
- **–ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—É—Å–∫–∏**: 1-2 –º–∏–Ω—É—Ç—ã
- **–°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö ETL**: 3-5 –º–∏–Ω—É—Ç (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –æ–±—ä–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö Selectel)

### ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–∞—à–±–æ—Ä–¥–æ–≤

–ö–æ–º–∞–Ω–¥–∞ `make docker-setup-complete` **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –¥–∞—à–±–æ—Ä–¥—ã, –µ—Å–ª–∏:

‚úÖ **–í —Ñ–∞–π–ª–µ `.env` —É–∫–∞–∑–∞–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**
```bash
REDASH_ADMIN_EMAIL=admin@selectel.local
REDASH_ADMIN_PASSWORD=admin123
```

**–ü—Ä–æ—Ü–µ—Å—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**

1. **–°–æ–∑–¥–∞–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞** (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):
   - –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –ø–µ—Ä–≤–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ `.env` —Ñ–∞–π–ª–∞

2. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–∞—à–±–æ—Ä–¥–æ–≤**:
   - –°–æ–∑–¥–∞–µ—Ç—Å—è –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö PostgreSQL
   - –°–æ–∑–¥–∞—é—Ç—Å—è 4 –≥–æ—Ç–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–∞
   - –°–æ–∑–¥–∞–µ—Ç—Å—è –æ—Å–Ω–æ–≤–Ω–æ–π –¥–∞—à–±–æ—Ä–¥

‚ùå **–ï—Å–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –Ω–µ—Ç** - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è —Ä—É—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
```bash
# –°–Ω–∞—á–∞–ª–∞ —É–∫–∞–∂–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ .env, –∑–∞—Ç–µ–º:
make setup-dashboards
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
- üîó –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö PostgreSQL
- üìä 4 –≥–æ—Ç–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–∞ (–±–∞–ª–∞–Ω—Å—ã, –ø—Ä–æ–≥–Ω–æ–∑—ã, –ø—Ä–æ–µ–∫—Ç—ã, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏)  
- üìà 1 –æ—Å–Ω–æ–≤–Ω–æ–π –¥–∞—à–±–æ—Ä–¥ —Å–æ –≤—Å–µ–º–∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è–º–∏

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± (–µ—Å–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç):**
1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:5000/setup
2. –°–æ–∑–¥–∞–π—Ç–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –≤—Ä—É—á–Ω—É—é (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ `.env`)
3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ `make setup-dashboards-only` (–ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞)

### üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

#### –ü—Ä–æ–±–ª–µ–º–∞: "–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è"
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
docker compose logs

# –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞–∑—ã
make docker-fresh-install
```

#### –ü—Ä–æ–±–ª–µ–º–∞: "ETL –Ω–µ —Å–æ–±–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ"
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ ETL
docker compose logs selectel-etl

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API —Ç–æ–∫–µ–Ω –≤ .env —Ñ–∞–π–ª–µ
```

#### –ü—Ä–æ–±–ª–µ–º–∞: "Redash –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è"
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤
docker compose ps

# –ü–æ–¥–æ–∂–¥–∏—Ç–µ 2-3 –º–∏–Ω—É—Ç—ã –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞
# –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:5000
```

### üìä –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (–±–µ–∑ Docker)

```bash
make install            # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
make setup             # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
make init-db           # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î
make run-once          # –ó–∞–ø—É—Å–∫ ETL –æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ
make run               # –ó–∞–ø—É—Å–∫ ETL –≤ —Ä–µ–∂–∏–º–µ –¥–µ–º–æ–Ω–∞

# üìù –õ–æ–≥–∏
make logs              # –õ–æ–∫–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏
make docker-logs       # Docker –ª–æ–≥–∏

# –û—á–∏—Å—Ç–∫–∞
make clean

# Docker –∫–æ–º–∞–Ω–¥—ã
make docker-build
make docker-up
make docker-down
make docker-logs
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
redash-std/
‚îú‚îÄ‚îÄ selectel_etl.py          # –û—Å–Ω–æ–≤–Ω–æ–π ETL-—Å–∫—Ä–∏–ø—Ç
‚îú‚îÄ‚îÄ models.py                # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îú‚îÄ‚îÄ init_db.py              # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î
‚îú‚îÄ‚îÄ test_etl.py             # –¢–µ—Å—Ç—ã —Å–∏—Å—Ç–µ–º—ã
‚îú‚îÄ‚îÄ requirements.txt         # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ config.env.example      # –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ redash_queries.sql      # SQL-–∑–∞–ø—Ä–æ—Å—ã –¥–ª—è Redash
‚îú‚îÄ‚îÄ swagger.yaml            # OpenAPI/Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API
‚îú‚îÄ‚îÄ swagger.html            # Swagger UI –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ API
‚îú‚îÄ‚îÄ setup_redash.sh         # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Redash
‚îú‚îÄ‚îÄ docker-compose.yml      # Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ Dockerfile              # Docker –æ–±—Ä–∞–∑
‚îú‚îÄ‚îÄ init.sql               # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è PostgreSQL
‚îú‚îÄ‚îÄ cron_etl.sh           # –°–∫—Ä–∏–ø—Ç –¥–ª—è cron
‚îú‚îÄ‚îÄ Makefile              # –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
‚îú‚îÄ‚îÄ logs/                 # –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ª–æ–≥–æ–≤
‚îî‚îÄ‚îÄ README.md            # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üìö API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### Swagger/OpenAPI
–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Selectel Billing API –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ OpenAPI 3.0:

- **swagger.yaml** - OpenAPI —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ YAML
- **swagger.html** - –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è Swagger UI –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

#### –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:
```bash
# –û—Ç–∫—Ä—ã—Ç—å swagger.html –≤ –±—Ä–∞—É–∑–µ—Ä–µ –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
open swagger.html
```

#### –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:
- `GET /v3/balances` - –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –±–∞–ª–∞–Ω—Å–∞—Ö
- `GET /v2/billing/prediction` - –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤ —Ä–∞—Å—Ö–æ–¥–æ–≤  
- `GET /v2/billing/transactions` - –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- `GET /v1/billing/report/by_project/detailed` - –û—Ç—á–µ—Ç—ã –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º

#### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:
–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã —Ç—Ä–µ–±—É—é—Ç –ø–µ—Ä–µ–¥–∞—á–∏ API —Ç–æ–∫–µ–Ω–∞ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `X-Token`.

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- API-—Ç–æ–∫–µ–Ω —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ë–î —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏
- –õ–æ–≥–∏ –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
- Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –æ—Ç –Ω–µ–ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## üö® –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤ –≤ Redash

1. **–ê–ª–µ—Ä—Ç –Ω–∞ –Ω–∏–∑–∫–∏–π –±–∞–ª–∞–Ω—Å**:
```sql
SELECT 
    account_id,
    currency,
    amount,
    credit_limit,
    CASE 
        WHEN amount < credit_limit * 0.1 THEN 'CRITICAL'
        WHEN amount < credit_limit * 0.3 THEN 'WARNING'
        ELSE 'OK'
    END as balance_status
FROM balances 
WHERE fetched_at = (SELECT MAX(fetched_at) FROM balances)
    AND amount < credit_limit * 0.3;
```


## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ API
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å API-—Ç–æ–∫–µ–Ω–∞
- –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API Selectel
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `make logs`

### –ü—Ä–æ–±–ª–µ–º—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ `.env`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ PostgreSQL –∑–∞–ø—É—â–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ü—Ä–æ–±–ª–µ–º—ã —Å Docker
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Docker –∏ Docker Compose —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø–æ—Ä—Ç–∞ 5432
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤: `make docker-logs`

### –ü—Ä–æ–±–ª–µ–º—ã —Å Redash
- **–û—à–∏–±–∫–∞ "relation 'organizations' does not exist"**: 
  - –ó–∞–ø—É—Å—Ç–∏—Ç–µ `make setup-redash` –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î
  - –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `make docker-setup-full` –¥–ª—è –ø–æ–ª–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- **Redash –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç**: –ü–æ–¥–æ–∂–¥–∏—Ç–µ 1-2 –º–∏–Ω—É—Ç—ã –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- **–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**: –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:5000/setup –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–õ–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `logs/`:
- `selectel_etl.log` - –æ—Å–Ω–æ–≤–Ω—ã–µ –ª–æ–≥–∏ ETL
- `cron.log` - –ª–æ–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ cron

## ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

1. –§–æ—Ä–∫–Ω–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –°–æ–∑–¥–∞–π—Ç–µ –≤–µ—Ç–∫—É –¥–ª—è –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
3. –í–Ω–µ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
4. –°–æ–∑–¥–∞–π—Ç–µ Pull Request

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º —Å–æ–∑–¥–∞–π—Ç–µ Issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.
